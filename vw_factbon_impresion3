CREATE VIEW [dbo].[vw_factbon_impresion3]
AS
 SELECT D_BONIF.COREL, D_BONIF.PRODUCTO, P_PRODUCTO.DESCLARGA, COUNT(D_BONIF_BARRA.BARRA) AS CANT,  CASE WHEN P_PRODUCTO.VENTA_POR_PESO =0 THEN  CASE WHEN P_PRODUCTO.ES_PROD_BARRA = 0 THEN   D_BONIF.UMVenta  ELSE   D_BONIF.UMstock  END  ELSE  D_BONIF.UMstock END AS UMVENTA, D_BONIF.UMPESO, SUM(D_BONIF_BARRA.PESO) AS PESO  FROM D_BONIF INNER JOIN D_BONIF_BARRA ON D_BONIF.COREL = D_BONIF_BARRA.COREL  AND D_BONIF.PRODUCTO = D_BONIF_BARRA.PRODUCTO  INNER JOIN P_PRODUCTO ON D_BONIF.PRODUCTO = P_PRODUCTO.CODIGO  GROUP BY D_BONIF.COREL, D_BONIF.PRODUCTO, P_PRODUCTO.DESCLARGA,  P_PRODUCTO.VENTA_POR_PESO, P_PRODUCTO.ES_PROD_BARRA, D_BONIF.UMVenta, D_BONIF.UMstock, D_BONIF.UMPESO  UNION  SELECT D_BONIF.COREL, D_BONIF.PRODUCTO, P_PRODUCTO.DESCLARGA, SUM(D_BONIF_LOTES.CANT) AS CANT,  CASE WHEN P_PRODUCTO.VENTA_POR_PESO =0 THEN  CASE WHEN P_PRODUCTO.ES_PROD_BARRA = 0 THEN   D_BONIF.UMVenta  ELSE   D_BONIF.UMstock  END  ELSE  D_BONIF.UMstock END AS UMVENTA, D_BONIF.UMPESO, SUM(D_BONIF_LOTES.PESO) AS PESO  FROM D_BONIF INNER JOIN D_BONIF_LOTES ON D_BONIF.COREL = D_BONIF_LOTES.COREL  AND D_BONIF.PRODUCTO = D_BONIF_LOTES.PRODUCTO  INNER JOIN P_PRODUCTO ON D_BONIF.PRODUCTO = P_PRODUCTO.CODIGO  GROUP BY D_BONIF.COREL, D_BONIF.PRODUCTO, P_PRODUCTO.DESCLARGA,  P_PRODUCTO.VENTA_POR_PESO, P_PRODUCTO.ES_PROD_BARRA, D_BONIF.UMVenta, D_BONIF.UMstock,D_BONIF.UMPESO 
GO
